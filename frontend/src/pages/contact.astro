---
import MainLayout from '../layouts/layout.astro';
import { directus } from '../lib/directus';
import { readSingleton } from '@directus/sdk';

// 1. Daten laden
let settings;
try {
    settings = await directus.request(readSingleton('global_settings'));
} catch (error) {
    console.error("Kontakt: Konnte Global Settings nicht laden", error);
}

// --- DATEN-LOGIK MIT FALLBACKS ---

// A) Öffnungszeiten
const defaultOpeningHours = [
    { label: "Montag – Donnerstag", time: "09:00 – 16:00", highlight: false },
    { label: "Freitag", time: "09:00 – 13:00", highlight: false },
    { label: "Veranstaltungen", time: "Je nach Programm", highlight: true }
];
const openingHours = settings?.opening_hours || defaultOpeningHours;

// B) Barrierefreiheit
const defaultAccessItems = [
    { label: "Ebenerdiger Zugang (Rampe)", icon: "wheelchair" },
    { label: "Euro-Key Behinderten-WC", icon: "restroom" },
    { label: "Behinderten-Parkplatz (Hof)", icon: "square-parking" },
    { label: "Assistenzhunde willkommen", icon: "dog" }
];
const accessibilityItems = settings?.accessibility_items || defaultAccessItems;

// C) FAQ
const defaultFaqs = [
    { question: "Ist die Brücke barrierefrei?", answer: "Ja, zu 100%. Der Zugang ist ebenerdig, wir verfügen über ein Euro-Key Behinderten-WC und breite Türen im gesamten Veranstaltungsbereich." },
    { question: "Kann man Räume mieten?", answer: "Ja, unsere Seminarräume und der Veranstaltungssaal können gemietet werden. Schreib uns einfach eine Anfrage an kultur@diebruecke.cc." },
    { question: "Muss ich Tickets reservieren?", answer: "Für größere Konzerte empfehlen wir eine Reservierung (via Mail oder Pretix). Bei den meisten offenen Abenden gilt: Einfach vorbeikommen!" },
    { question: "Kann ich ein Praktikum machen?", answer: "Gerne! Wir bieten Plätze für Sozialpraktika, Zivildienst und ehrenamtliche Mitarbeit. Meld dich bei sozial@diebruecke.cc." }
];
const faqs = settings?.faqs || defaultFaqs;

const departments = [
    {
        title: "Zentrale & Verwaltung",
        desc: "Allgemeine Anfragen, Mitgliedschaften und Spenden.",
        mail: "office@diebruecke.cc",
        phone: "+43 316 67 22 48",
        icon: "fa-building"
    },
    {
        title: "Mobile Dienste (LEVO)",
        desc: "Anfragen zu Wohnassistenz, Freizeitassistenz und Familienentlastung.",
        mail: "sozial@diebruecke.cc",
        phone: "+43 316 67 22 48", 
        icon: "fa-hand-holding-heart"
    },
    {
        title: "Kultur & Events",
        desc: "Ticketreservierung, Raumanfragen und Künstler-Booking.",
        mail: "kultur@diebruecke.cc",
        phone: "+43 316 67 22 48",
        icon: "fa-music"
    }
];
---

<MainLayout title="Kontakt">
    
    <div class="home-content px-4 md:px-6">

    {/* --- HERO --- */}
    <section class="relative px-6 sm:px-10 pt-32 pb-20 bg-white dark:bg-slate-950 rounded-t-[32px] md:rounded-t-[64px] overflow-hidden transition-colors duration-300">
        <div class="max-w-7xl mx-auto relative z-10">
            <span class="inline-block px-3 py-1 rounded-full bg-slate-100 dark:bg-slate-800 text-slate-500 dark:text-slate-400 text-xs font-bold uppercase tracking-widest mb-6">
                Erreichbarkeit
            </span>
            <h1 class="text-5xl md:text-7xl lg:text-8xl font-display font-extrabold text-slate-900 dark:text-white tracking-tighter mb-8 leading-[0.9]">
                Wir sind <br>
                <span class="text-transparent bg-clip-text bg-gradient-to-r from-rose-600 to-slate-600 dark:to-slate-400">für dich da.</span>
            </h1>
            <p class="text-xl text-slate-500 dark:text-slate-400 max-w-2xl font-medium leading-relaxed">
                Du hast Fragen zu unseren Angeboten, möchtest Tickets reservieren oder brauchst Unterstützung? 
                Schreib uns, ruf an oder komm einfach vorbei.
            </p>
        </div>
        <div class="absolute top-0 right-0 -mr-20 -mt-20 w-[600px] h-[600px] bg-slate-100 dark:bg-slate-900 rounded-full blur-3xl opacity-50 pointer-events-none"></div>
    </section>

    <section class="px-6 sm:px-10 pb-24 bg-white dark:bg-slate-950 transition-colors duration-300">
        <div class="max-w-7xl mx-auto grid lg:grid-cols-2 gap-16 lg:gap-24">
            
            <div class="space-y-12">
                
                {/* --- INFO BOX & KARTE --- */}
                <div class="bg-slate-50 dark:bg-slate-900 rounded-[32px] border border-slate-100 dark:border-slate-800 overflow-hidden transition-colors duration-300">
                    
                    <div class="relative w-full h-64 bg-slate-200 dark:bg-slate-800 group" id="map-container">
                        <iframe 
                            id="google-map"
                            class="w-full h-full absolute inset-0 hidden"
                            loading="lazy"
                            allowfullscreen
                            referrerpolicy="no-referrer-when-downgrade">
                        </iframe>

                        <div id="map-placeholder" class="absolute inset-0 bg-cover bg-center flex flex-col items-center justify-center p-6 text-center transition-all cursor-pointer hover:bg-slate-300/50 dark:hover:bg-slate-700/50" 
                             style="background-image: url('https://maps.googleapis.com/maps/api/staticmap?center=Grabenstraße+39a,Graz&zoom=15&size=800x400&maptype=roadmap&style=feature:all|saturation:-100&key=YOUR_API_KEY_PLACEHOLDER'); background-color: #cbd5e1;">
                             
                            {/* Overlay Pattern */}
                            <div class="absolute inset-0 bg-slate-200 dark:bg-slate-800 opacity-50" style="background-image: radial-gradient(#94a3b8 1px, transparent 1px); background-size: 20px 20px;"></div>
                            
                            <div class="relative z-10 bg-white/90 dark:bg-slate-900/90 backdrop-blur-md p-6 rounded-2xl shadow-xl border border-white/50 dark:border-white/10 max-w-xs text-center">
                                <div class="w-12 h-12 bg-rose-600 rounded-full flex items-center justify-center text-white text-xl mx-auto mb-3 shadow-lg">
                                    <i class="fa-solid fa-location-dot"></i>
                                </div>
                                <h4 class="font-bold text-slate-900 dark:text-white mb-1">Karte laden</h4>
                                <p class="text-xs text-slate-500 dark:text-slate-400 mb-4">
                                    Mit dem Klick akzeptierst du, dass Daten an Google Maps übertragen werden.
                                </p>
                                <button id="btn-load-map" class="bg-slate-900 dark:bg-white text-white dark:text-slate-900 text-xs font-bold uppercase tracking-widest px-4 py-2 rounded-full hover:bg-rose-600 dark:hover:bg-rose-400 dark:hover:text-white transition-colors w-full">
                                    Karte aktivieren
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="p-8">
                        <div class="flex items-start gap-4 mb-8">
                            <div>
                                <h3 class="font-bold text-xl text-slate-900 dark:text-white leading-tight mb-2">Die Brücke <br><span class="text-sm font-normal text-slate-500 dark:text-slate-400">soziokulturelles Zentrum</span></h3>
                                <p class="text-slate-500 dark:text-slate-400 leading-relaxed text-lg">
                                    Grabenstraße 39a <br>
                                    8010 Graz <br>
                                    Österreich
                                </p>
                                <a href="http://googleusercontent.com/maps.google.com/maps?q=Die+Brücke+Graz+Grabenstraße+39a" target="_blank" class="inline-flex items-center gap-2 text-sm font-bold text-rose-600 dark:text-rose-400 mt-4 hover:underline">
                                    In Google Maps öffnen <i class="fa-solid fa-arrow-up-right-from-square"></i>
                                </a>
                            </div>
                        </div>

                        <div class="h-px bg-slate-200 dark:bg-slate-800 w-full mb-8"></div>

                        <h4 class="font-bold text-slate-900 dark:text-white mb-4 flex items-center gap-2">
                            <i class="fa-solid fa-bus text-slate-400"></i> Anfahrt mit Öffis
                        </h4>
                        
                        <div class="space-y-6">
                            <div>
                                <p class="text-slate-900 dark:text-white text-sm font-bold mb-1">Straßenbahn (Richtung Andritz)</p>
                                <p class="text-slate-500 dark:text-slate-400 text-sm mb-2">Haltestelle <strong class="text-slate-700 dark:text-slate-300">Hasnerplatz / Päd. Hochschule</strong>. Von dort kurzer Fußweg durch den Park.</p>
                                <div class="flex flex-wrap gap-2">
                                    <span class="px-2 py-1 rounded bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 text-xs font-bold text-slate-600 dark:text-slate-300">Linie 3</span>
                                    <span class="px-2 py-1 rounded bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 text-xs font-bold text-slate-600 dark:text-slate-300">Linie 5</span>
                                </div>
                            </div>

                            <div>
                                <p class="text-slate-900 dark:text-white text-sm font-bold mb-1">Bus</p>
                                <p class="text-slate-500 dark:text-slate-400 text-sm mb-2">Haltestelle <strong class="text-slate-700 dark:text-slate-300">Grabenstraße</strong>.</p>
                                <div class="flex flex-wrap gap-2">
                                    <span class="px-2 py-1 rounded bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 text-xs font-bold text-slate-600 dark:text-slate-300">Bus 39</span>
                                    <span class="px-2 py-1 rounded bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 text-xs font-bold text-slate-600 dark:text-slate-300">Bus 63</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                {/* --- BARRIEREFREIHEIT --- */}
                {accessibilityItems.length > 0 && (
                    <div class="bg-indigo-50 dark:bg-indigo-900/20 rounded-[32px] p-8 border border-indigo-100 dark:border-indigo-900/30">
                        <h3 class="text-lg font-display font-bold text-indigo-900 dark:text-indigo-200 mb-4 flex items-center gap-2">
                            <i class="fa-solid fa-universal-access"></i> Barrierefreiheit
                        </h3>
                        <ul class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            {accessibilityItems.map((item: any) => (
                                <li class="flex items-center gap-3 text-sm text-indigo-800 dark:text-indigo-300 font-medium">
                                    <span class="w-8 h-8 rounded-full bg-white dark:bg-indigo-900 flex items-center justify-center text-indigo-600 dark:text-indigo-400 shrink-0">
                                        <i class={`fa-solid fa-${item.icon || 'check'}`}></i>
                                    </span>
                                    {item.label}
                                </li>
                            ))}
                        </ul>
                    </div>
                )}

                {/* --- ÖFFNUNGSZEITEN --- */}
                <div>
                    <h3 class="text-2xl font-display font-bold text-slate-900 dark:text-white mb-6">Bürozeiten</h3>
                    <ul class="space-y-4 text-slate-600 dark:text-slate-300">
                        {openingHours.map((slot: any) => (
                            <li class={`flex justify-between border-b border-slate-100 dark:border-slate-800 pb-2 ${slot.highlight ? 'text-rose-600 dark:text-rose-400 font-medium' : ''}`}>
                                <span>{slot.label}</span>
                                <span class="font-bold">{slot.time}</span>
                            </li>
                        ))}
                    </ul>
                </div>
            </div>

            {/* --- RECHTE SPALTE: FORMULAR & FAQ --- */}
            <div class="space-y-12">
                
                {/* KONTAKTFORMULAR (LIVE) */}
                <div class="bg-white dark:bg-slate-900 rounded-[40px] shadow-2xl shadow-slate-200/50 dark:shadow-none p-8 md:p-12 border border-slate-100 dark:border-slate-800 relative overflow-hidden h-fit transition-colors duration-300">
                    <div class="absolute top-0 right-0 w-64 h-64 bg-rose-50 dark:bg-rose-900/20 rounded-full blur-3xl -translate-y-1/2 translate-x-1/2 pointer-events-none"></div>

                    <h3 class="text-3xl font-display font-bold text-slate-900 dark:text-white mb-2 relative z-10">Schreib uns</h3>
                    <p class="text-slate-500 dark:text-slate-400 mb-8 relative z-10 font-medium">Wir melden uns so schnell wie möglich bei dir.</p>

                    <form id="contact-form" class="space-y-6 relative z-10">
                        
                        {/* Status Message Container */}
                        <div id="form-message" class="hidden p-4 rounded-xl text-sm font-bold mb-4"></div>

                        <div class="grid md:grid-cols-2 gap-6">
                            <div class="space-y-2">
                                <label for="name" class="text-xs font-bold uppercase tracking-widest text-slate-500 dark:text-slate-400 ml-4">Name</label>
                                <input type="text" id="name" name="name" required class="w-full bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-2xl px-6 py-4 outline-none focus:ring-2 focus:ring-rose-500 focus:border-transparent transition-all dark:text-white" placeholder="Dein Name" />
                            </div>
                            <div class="space-y-2">
                                <label for="email" class="text-xs font-bold uppercase tracking-widest text-slate-500 dark:text-slate-400 ml-4">E-Mail</label>
                                <input type="email" id="email" name="email" required class="w-full bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-2xl px-6 py-4 outline-none focus:ring-2 focus:ring-rose-500 focus:border-transparent transition-all dark:text-white" placeholder="deine@mail.com" />
                            </div>
                        </div>

                        <div class="space-y-2">
                            <label for="subject" class="text-xs font-bold uppercase tracking-widest text-slate-500 dark:text-slate-400 ml-4">Betreff</label>
                            <select id="subject" name="subject" class="w-full bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-2xl px-6 py-4 outline-none focus:ring-2 focus:ring-rose-500 focus:border-transparent transition-all appearance-none font-medium dark:text-white">
                                <option>Allgemeine Anfrage</option>
                                <option>Soziale Dienste (LEVO)</option>
                                <option>Tickets & Events</option>
                                <option>Raummiete</option>
                                <option>Ehrenamt & Jobs</option>
                            </select>
                        </div>

                        <div class="space-y-2">
                            <label for="message" class="text-xs font-bold uppercase tracking-widest text-slate-500 dark:text-slate-400 ml-4">Nachricht</label>
                            <textarea id="message" name="message" rows="5" required class="w-full bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-2xl px-6 py-4 outline-none focus:ring-2 focus:ring-rose-500 focus:border-transparent transition-all dark:text-white" placeholder="Wie können wir helfen?"></textarea>
                        </div>

                        <div class="pt-4">
                            <button type="submit" id="submit-btn" class="w-full bg-slate-900 dark:bg-white text-white dark:text-slate-900 font-bold text-lg rounded-2xl py-4 hover:bg-rose-600 dark:hover:bg-rose-400 dark:hover:text-white transition-all shadow-lg hover:shadow-rose-500/25 transform active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed">
                                <span>Nachricht absenden</span>
                            </button>
                        </div>
                    </form>
                </div>

                {/* --- FAQ ACCORDION --- */}
                {faqs.length > 0 && (
                    <div class="pt-8">
                        <h3 class="text-2xl font-display font-bold text-slate-900 dark:text-white mb-6">Häufige Fragen</h3>
                        <div class="space-y-4">
                            {faqs.map((faq: any) => (
                                <details class="group bg-slate-50 dark:bg-slate-900 rounded-2xl overflow-hidden border border-slate-100 dark:border-slate-800 open:bg-white dark:open:bg-slate-800 open:shadow-lg transition-all duration-300">
                                    <summary class="flex items-center justify-between p-6 cursor-pointer font-bold text-slate-700 dark:text-slate-200 hover:text-rose-600 dark:hover:text-rose-400 transition-colors list-none outline-none">
                                        <span>{faq.question || faq.q}</span>
                                        <span class="w-8 h-8 rounded-full bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 flex items-center justify-center text-slate-400 group-open:rotate-180 group-open:bg-rose-50 dark:group-open:bg-rose-900/20 group-open:text-rose-600 transition-all">
                                            <i class="fa-solid fa-chevron-down text-xs"></i>
                                        </span>
                                    </summary>
                                    <div class="px-6 pb-6 text-slate-500 dark:text-slate-400 leading-relaxed text-sm animate-fade-in">
                                        {faq.answer || faq.a}
                                    </div>
                                </details>
                            ))}
                        </div>
                    </div>
                )}

            </div>

        </div>
    </section>

    {/* ... DEPARTMENTS & JOIN US (Gleich wie vorher) ... */}
    <section class="px-6 sm:px-10 py-24 bg-slate-900 text-white rounded-[48px] dark:border dark:border-slate-800">
        <div class="max-w-7xl mx-auto">
            <div class="text-center mb-16">
                <h2 class="text-3xl md:text-5xl font-display font-bold mb-4 tracking-tight">Der direkte Draht</h2>
                <p class="text-slate-400 font-medium tracking-wide uppercase text-xs">Damit du gleich bei der richtigen Person landest.</p>
            </div>

            <div class="grid md:grid-cols-3 gap-8">
                {departments.map(dept => (
                    <div class="bg-white/5 border border-white/10 rounded-3xl p-8 hover:bg-white/10 transition-colors text-center group">
                        <div class="w-16 h-16 rounded-2xl bg-slate-800 flex items-center justify-center mx-auto mb-6 text-2xl group-hover:scale-110 transition-transform text-rose-500 shadow-lg">
                            <i class={`fa-solid ${dept.icon}`}></i>
                        </div>
                        <h3 class="text-xl font-display font-bold mb-3">{dept.title}</h3>
                        <p class="text-slate-400 text-sm mb-6 leading-relaxed h-12 font-medium">
                            {dept.desc}
                        </p>
                        <div class="space-y-2 pt-6 border-t border-white/5">
                            <a href={`mailto:${dept.mail}`} class="block text-rose-400 font-bold hover:text-white transition-colors">{dept.mail}</a>
                            <a href={`tel:${dept.phone}`} class="block text-slate-300 hover:text-white transition-colors text-sm">{dept.phone}</a>
                        </div>
                    </div>
                ))}
            </div>
        </div>
    </section>

    <section class="px-6 sm:px-10 py-24 bg-white dark:bg-slate-950 transition-colors duration-300">
        <div class="max-w-7xl mx-auto">
            <a href="/join" class="group relative bg-indigo-600 rounded-[48px] p-10 md:p-14 overflow-hidden flex flex-col lg:flex-row items-center justify-between gap-10 shadow-xl hover:shadow-indigo-200 dark:hover:shadow-none transition-all duration-500">
                <div class="absolute inset-0 bg-[radial-gradient(circle_at_bottom_left,rgba(255,255,255,0.1),transparent)] pointer-events-none"></div>
                <div class="relative z-10 flex flex-col lg:flex-row items-center gap-10 text-center lg:text-left">
                    <div class="w-20 h-20 rounded-3xl bg-white/10 flex items-center justify-center text-white text-3xl border border-white/20 group-hover:rotate-6 transition-transform">
                        <i class="fa-solid fa-rocket"></i>
                    </div>
                    <div>
                        <h2 class="text-3xl md:text-4xl font-display font-bold text-white mb-3 tracking-tight">Werde ein Brückenpfeiler.</h2>
                        <p class="text-indigo-100 max-w-xl font-medium text-lg leading-relaxed">
                            Inklusion braucht Menschen, die mit anpacken. Ob Ehrenamt, Praktikum oder Zivildienst – dein Engagement stärkt unser gemeinsames Fundament.
                        </p>
                    </div>
                </div>
                <div class="relative z-10 shrink-0">
                    <span class="px-10 py-5 bg-white text-indigo-600 rounded-full font-bold group-hover:bg-slate-900 group-hover:text-white transition-all inline-flex items-center gap-3 shadow-lg">
                        Mitmachen & Bewegen <i class="fa-solid fa-arrow-right"></i>
                    </span>
                </div>
            </a>
        </div>
    </section>

    {/* --- EXIT --- */}
    <section class="bg-white dark:bg-slate-950 pt-24 pb-16 text-center transition-colors duration-300">
        <div class="max-w-4xl mx-auto px-6">
            <p class="text-slate-400 dark:text-slate-500 font-medium text-xl italic leading-relaxed">
                „Inklusion ist keine Einzelleistung. <br class="hidden md:block"> Es ist das Ergebnis vieler kleiner Begegnungen.“
            </p>
            <div class="mt-12 flex flex-col items-center">
                <div class="w-2 h-2 rounded-full bg-rose-500 mb-2"></div>
                <div class="w-0.5 h-24 bg-gradient-to-b from-rose-500 via-slate-200 dark:via-slate-800 to-transparent"></div>
            </div>
        </div>
    </section>

    </div>
</MainLayout>

{/* --- SEO: SCHEMA.ORG --- */}
<script type="application/ld+json" set:html={JSON.stringify({
  "@context": "https://schema.org",
  "@type": "CommunityCenter",
  "name": "Die Brücke - soziokulturelles Zentrum",
  "url": "https://diebruecke.cc",
  "telephone": "+43 316 67 22 48",
  "email": "office@diebruecke.cc",
  "address": {
    "@type": "PostalAddress",
    "streetAddress": "Grabenstraße 39a",
    "addressLocality": "Graz",
    "postalCode": "8010",
    "addressCountry": "AT"
  },
  "geo": {
    "@type": "GeoCoordinates",
    "latitude": 47.085, 
    "longitude": 15.435 
  },
  "openingHoursSpecification": openingHours.map(h => {
      let days = [];
      if(h.label.includes('Montag')) days.push("Monday");
      if(h.label.includes('Dienstag')) days.push("Tuesday");
      if(h.label.includes('Mittwoch')) days.push("Wednesday");
      if(h.label.includes('Donnerstag')) days.push("Thursday");
      if(h.label.includes('Freitag')) days.push("Friday");
      if(h.label.includes('Samstag')) days.push("Saturday");
      if(h.label.includes('Sonntag')) days.push("Sunday");
      if(h.label.includes('Montag') && h.label.includes('Donnerstag')) days = ["Monday", "Tuesday", "Wednesday", "Thursday"];
      return { "@type": "OpeningHoursSpecification", "dayOfWeek": days, "opens": h.time.split('–')[0]?.trim() || "09:00", "closes": h.time.split('–')[1]?.trim() || "16:00" };
  }).filter(o => o.dayOfWeek.length > 0)
})} />

<script>
    // 1. Google Maps Logic
    function initMapLogic() {
        const placeholder = document.getElementById('map-placeholder');
        const iframe = document.getElementById('google-map');
        const address = "Die Brücke Graz Grabenstraße 39a";
        const mapUrl = `https://maps.google.com/maps?q=${encodeURIComponent(address)}&t=&z=15&ie=UTF8&iwloc=&output=embed`;

        if (placeholder && iframe) {
            placeholder.addEventListener('click', () => {
                iframe.setAttribute('src', mapUrl);
                iframe.classList.remove('hidden');
                placeholder.style.display = 'none';
            });
        }
    }

    // 2. Form Logic (SEND TO API)
    function initFormLogic() {
        const form = document.getElementById('contact-form') as HTMLFormElement;
        const msgBox = document.getElementById('form-message');
        const submitBtn = document.getElementById('submit-btn');

        if(form && msgBox && submitBtn) {
            form.addEventListener('submit', async (e) => {
                e.preventDefault();
                
                // UI: Loading State
                const originalBtnText = submitBtn.innerHTML;
                submitBtn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Senden...';
                submitBtn.setAttribute('disabled', 'true');
                msgBox.classList.add('hidden');

                // Data
                const formData = new FormData(form);
                const data = Object.fromEntries(formData.entries());

                try {
                    // Call Astro API Endpoint
                    const response = await fetch('/api/contact', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(data)
                    });

                    const result = await response.json();

                    if(response.ok) {
                        // Success
                        msgBox.innerHTML = `<i class="fa-solid fa-check-circle"></i> ${result.message}`;
                        msgBox.className = "p-4 rounded-xl text-sm font-bold mb-4 bg-emerald-100 text-emerald-800 border border-emerald-200 block";
                        form.reset();
                    } else {
                        // Error from API
                        throw new Error(result.message || 'Fehler beim Senden');
                    }

                } catch (error) {
                    console.error(error);
                    msgBox.innerHTML = `<i class="fa-solid fa-triangle-exclamation"></i> ${error.message || 'Verbindungsfehler. Bitte versuche es später.'}`;
                    msgBox.className = "p-4 rounded-xl text-sm font-bold mb-4 bg-rose-100 text-rose-800 border border-rose-200 block";
                } finally {
                    // Reset Button
                    submitBtn.innerHTML = originalBtnText;
                    submitBtn.removeAttribute('disabled');
                }
            });
        }
    }

    // Init
    const init = () => {
        initMapLogic();
        initFormLogic();
    }
    
    init();
    document.addEventListener('astro:after-swap', init);
</script>

<style>
    details > summary { list-style: none; }
    details > summary::-webkit-details-marker { display: none; }
    
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(-5px); }
        to { opacity: 1; transform: translateY(0); }
    }
    .animate-fade-in { animation: fadeIn 0.3s ease-out forwards; }
</style>