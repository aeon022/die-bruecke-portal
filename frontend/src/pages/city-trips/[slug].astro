---
export const prerender = false;

import MainLayout from '../../layouts/layout.astro';
import { directus } from '../../lib/directus';
import { readItems } from '@directus/sdk';

const { slug } = Astro.params;

let trip = null;

try {
  const result = await directus.request(readItems('city_trips', {
    filter: {
      slug: { _eq: slug },
      status: { _eq: 'published' }
    }
  }));
  if (result && result.length > 0) trip = result[0];
} catch (error) {
  console.error(`Fehler bei City Trip ${slug}:`, error);
}

if (!trip) return Astro.redirect('/404');

const ASSET_URL = "http://localhost:8055/assets";
const heroImage = trip.image ? `${ASSET_URL}/${trip.image}` : null;
---

<MainLayout title={`${trip.title} | City Trips`}>

    {/* HERO HEADER */}
    <section class="relative pt-32 pb-20 bg-slate-900 overflow-hidden">
        <div class="absolute inset-0 opacity-30">
            {heroImage && (
                <img src={heroImage} alt={trip.title} class="w-full h-full object-cover" />
            )}
            <div class="absolute inset-0 bg-gradient-to-t from-slate-900 to-transparent"></div>
        </div>

        <div class="container mx-auto px-6 relative z-10">
            <a href="/city-trips" class="inline-flex items-center text-slate-400 hover:text-white mb-8 transition-colors text-sm font-bold uppercase tracking-widest">
                <i class="fa-solid fa-arrow-left mr-2"></i> Alle Ausflüge
            </a>
            
            <div class="max-w-4xl">
                <div class="flex flex-wrap gap-3 mb-6">
                    {trip.free_spots > 0 ? (
                        <span class="px-3 py-1 rounded-full bg-emerald-500/20 text-emerald-400 border border-emerald-500/30 text-xs font-bold uppercase">
                            {trip.free_spots} Plätze frei
                        </span>
                    ) : (
                        <span class="px-3 py-1 rounded-full bg-rose-500/20 text-rose-400 border border-rose-500/30 text-xs font-bold uppercase">
                            Ausgebucht
                        </span>
                    )}
                </div>

                <h1 class="text-4xl md:text-6xl font-display font-extrabold text-white mb-6 leading-tight">
                    {trip.title}
                </h1>
            </div>
        </div>
    </section>

    {/* CONTENT */}
    <section class="py-16 px-6 bg-white">
        <div class="container mx-auto">
            <div class="grid lg:grid-cols-3 gap-12 max-w-7xl mx-auto">
                
                <div class="lg:col-span-2">
                    <h2 class="text-2xl font-display font-bold text-slate-900 mb-6">Infos zum Ausflug</h2>
                    <div class="prose prose-lg text-slate-600 prose-headings:text-slate-900 prose-a:text-indigo-600" set:html={trip.description}></div>
                </div>

                <div class="lg:col-span-1">
                    <div class="bg-slate-50 border border-slate-200 rounded-3xl p-8 sticky top-24">
                        <h3 class="text-xl font-bold text-slate-900 mb-6 border-b border-slate-200 pb-4">Eckdaten</h3>
                        
                        <div class="space-y-6">
                            <div class="flex items-start gap-4">
                                <div class="w-10 h-10 rounded-full bg-indigo-100 flex items-center justify-center shrink-0">
                                    <i class="fa-regular fa-calendar text-indigo-600"></i>
                                </div>
                                <div>
                                    <span class="block text-xs font-bold text-slate-400 uppercase">Wann?</span>
                                    <span class="text-slate-900 font-medium">{trip.date_range}</span>
                                </div>
                            </div>

                            <div class="flex items-start gap-4">
                                <div class="w-10 h-10 rounded-full bg-indigo-100 flex items-center justify-center shrink-0">
                                    <i class="fa-solid fa-location-dot text-indigo-600"></i>
                                </div>
                                <div>
                                    <span class="block text-xs font-bold text-slate-400 uppercase">Wohin?</span>
                                    <span class="text-slate-900 font-medium">{trip.location}</span>
                                </div>
                            </div>
                            
                            <div class="p-4 bg-white rounded-2xl border border-slate-100 mt-6">
                                <div class="flex justify-between items-center mb-2">
                                    <span class="text-slate-500 text-sm">Kostenbeitrag</span>
                                    <span class="text-xl font-bold text-slate-900">€ {trip.price},-</span>
                                </div>
                                {trip.fass_hours && (
                                    <div class="flex justify-between items-center pt-2 border-t border-slate-50">
                                        <span class="text-slate-500 text-sm flex items-center gap-1">
                                            <i class="fa-solid fa-info-circle text-slate-300"></i> FASS
                                        </span>
                                        <span class="font-bold text-slate-700">{trip.fass_hours} h</span>
                                    </div>
                                )}
                            </div>
                        </div>

                        <div class="mt-8">
                            <a href={`/contact?subject=Anfrage für City Trip: ${trip.title}`} 
                               class="block w-full py-4 bg-indigo-600 hover:bg-indigo-700 text-white text-center font-bold rounded-xl transition-colors shadow-lg shadow-indigo-200">
                                Jetzt Anfragen
                            </a>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </section>

</MainLayout>---
export const prerender = false;

import MainLayout from '../../layouts/layout.astro';
import { directus } from '../../lib/directus';
import { readItems } from '@directus/sdk';

const { slug } = Astro.params;

let trip = null;

try {
  const result = await directus.request(readItems('city_trips', {
    filter: {
      slug: { _eq: slug },
      status: { _eq: 'published' }
    }
  }));
  if (result && result.length > 0) trip = result[0];
} catch (error) {
  console.error(`Fehler bei City Trip ${slug}:`, error);
}

if (!trip) return Astro.redirect('/404');

const ASSET_URL = "http://localhost:8055/assets";
const heroImage = trip.image ? `${ASSET_URL}/${trip.image}` : null;
---

<MainLayout title={`${trip.title} | City Trips`}>

    {/* HERO HEADER */}
    <section class="relative pt-32 pb-20 bg-slate-900 overflow-hidden">
        <div class="absolute inset-0 opacity-30">
            {heroImage && (
                <img src={heroImage} alt={trip.title} class="w-full h-full object-cover" />
            )}
            <div class="absolute inset-0 bg-gradient-to-t from-slate-900 to-transparent"></div>
        </div>

        <div class="container mx-auto px-6 relative z-10">
            <a href="/city-trips" class="inline-flex items-center text-slate-400 hover:text-white mb-8 transition-colors text-sm font-bold uppercase tracking-widest">
                <i class="fa-solid fa-arrow-left mr-2"></i> Alle Ausflüge
            </a>
            
            <div class="max-w-4xl">
                <div class="flex flex-wrap gap-3 mb-6">
                    {trip.free_spots > 0 ? (
                        <span class="px-3 py-1 rounded-full bg-emerald-500/20 text-emerald-400 border border-emerald-500/30 text-xs font-bold uppercase">
                            {trip.free_spots} Plätze frei
                        </span>
                    ) : (
                        <span class="px-3 py-1 rounded-full bg-rose-500/20 text-rose-400 border border-rose-500/30 text-xs font-bold uppercase">
                            Ausgebucht
                        </span>
                    )}
                </div>

                <h1 class="text-4xl md:text-6xl font-display font-extrabold text-white mb-6 leading-tight">
                    {trip.title}
                </h1>
            </div>
        </div>
    </section>

    {/* CONTENT */}
    <section class="py-16 px-6 bg-white">
        <div class="container mx-auto">
            <div class="grid lg:grid-cols-3 gap-12 max-w-7xl mx-auto">
                
                <div class="lg:col-span-2">
                    <h2 class="text-2xl font-display font-bold text-slate-900 mb-6">Infos zum Ausflug</h2>
                    <div class="prose prose-lg text-slate-600 prose-headings:text-slate-900 prose-a:text-indigo-600" set:html={trip.description}></div>
                </div>

                <div class="lg:col-span-1">
                    <div class="bg-slate-50 border border-slate-200 rounded-3xl p-8 sticky top-24">
                        <h3 class="text-xl font-bold text-slate-900 mb-6 border-b border-slate-200 pb-4">Eckdaten</h3>
                        
                        <div class="space-y-6">
                            <div class="flex items-start gap-4">
                                <div class="w-10 h-10 rounded-full bg-indigo-100 flex items-center justify-center shrink-0">
                                    <i class="fa-regular fa-calendar text-indigo-600"></i>
                                </div>
                                <div>
                                    <span class="block text-xs font-bold text-slate-400 uppercase">Wann?</span>
                                    <span class="text-slate-900 font-medium">{trip.date_range}</span>
                                </div>
                            </div>

                            <div class="flex items-start gap-4">
                                <div class="w-10 h-10 rounded-full bg-indigo-100 flex items-center justify-center shrink-0">
                                    <i class="fa-solid fa-location-dot text-indigo-600"></i>
                                </div>
                                <div>
                                    <span class="block text-xs font-bold text-slate-400 uppercase">Wohin?</span>
                                    <span class="text-slate-900 font-medium">{trip.location}</span>
                                </div>
                            </div>
                            
                            <div class="p-4 bg-white rounded-2xl border border-slate-100 mt-6">
                                <div class="flex justify-between items-center mb-2">
                                    <span class="text-slate-500 text-sm">Kostenbeitrag</span>
                                    <span class="text-xl font-bold text-slate-900">€ {trip.price},-</span>
                                </div>
                                {trip.fass_hours && (
                                    <div class="flex justify-between items-center pt-2 border-t border-slate-50">
                                        <span class="text-slate-500 text-sm flex items-center gap-1">
                                            <i class="fa-solid fa-info-circle text-slate-300"></i> FASS
                                        </span>
                                        <span class="font-bold text-slate-700">{trip.fass_hours} h</span>
                                    </div>
                                )}
                            </div>
                        </div>

                        <div class="mt-8">
                            <a href={`/contact?subject=Anfrage für City Trip: ${trip.title}`} 
                               class="block w-full py-4 bg-indigo-600 hover:bg-indigo-700 text-white text-center font-bold rounded-xl transition-colors shadow-lg shadow-indigo-200">
                                Jetzt Anfragen
                            </a>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </section>

</MainLayout>